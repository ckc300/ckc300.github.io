<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>é›¨è»’è¨ˆæ™‚å™¨ æ»‘å‹•é¸å–å‹å–„ç‰ˆ</title>
<style>
body {
    background: #111;
    color: #fff;
    font-family: 'Noto Sans TC', Arial, sans-serif;
    margin: 0; padding: 0;
    min-height: 100vh;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
}
h1 {
    margin-top: 1em;
    font-size: 2.2em;
    font-weight: bold;
    letter-spacing: 0.09em;
}
.presets {
    margin: 2em 0 1.3em 0;
}
.preset-btn {
    background: #004165;
    color: #fff;
    border: none;
    border-radius: 50%;
    width: 70px; height: 70px;
    font-size: 1.1em;
    margin: 0 10px;
    font-weight: bold;
    box-shadow: 0 2px 8px #0004;
    cursor: pointer;
    transition: background .2s, color .2s, transform .15s;
}
.preset-btn.selected,
.preset-btn:active {
    background: #FFD700;
    color: #222;
    transform: scale(1.07);
    box-shadow: 0 0 20px #FFD70077;
}
.timer-display {
    font-family: 'Roboto Mono', monospace;
    font-size: clamp(3.2rem, 12vw, 8rem);
    font-weight: bold;
    background: #000;
    border-radius: 16px;
    padding: 0.2em 0.7em;
    margin: 1.5em 0 2em 0;
    box-shadow: 0 2px 8px #0006;
    letter-spacing: 0.06em;
    min-width: 200px;
    text-align: center;
}

.controls-fab {
    display: flex;
    justify-content: center;
    gap: 22px;
    margin-bottom: 2em;
}
.controls-fab button {
    font-size: 1.3em;
    font-weight: bold;
    padding: 1em 2.2em;
    border-radius: 14px;
    border: 2px solid #FFD700;
    background: #FFD700;
    color: #222;
    box-shadow: 0 2px 8px #0002;
    cursor: pointer;
    transition: filter 0.15s;
}
.controls-fab button:active {
    filter: brightness(0.95);
}
.controls-fab button:disabled {
    background: #444;
    border-color: #888;
    color: #ccc;
    cursor: not-allowed;
}
.bottom-bar {
    position: fixed; left: 0; right: 0; bottom: 1vw;
    display: flex; justify-content: center; gap: 22px; z-index: 30;
}
.bottom-bar button {
    background: #232323;
    color: #fff;
    border: 2px solid #fff;
    font-size: 1.07em;
    border-radius: 12px;
    padding: 0.6em 2em 0.6em 1.3em;
    font-weight: bold;
    box-shadow: 0 2px 8px #0003;
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
}
.bottom-bar button:hover { border-color: #FFD700; color: #FFD700;}
/* Modal */
.modal {
    display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
    background: rgba(0,0,0,0.7); z-index: 99;
    align-items: center; justify-content: center;
}
.modal-content {
    background: #181818;
    color: #fff;
    padding: 30px 6vw 24px 6vw;
    border-radius: 18px;
    min-width: 270px;
    max-width: 98vw;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    align-items: center;        /* æ°´å¹³å±…ä¸­ */
    justify-content: center;    /* å‚ç›´å±…ä¸­ */
}
.modal-content h3 { font-size: 1.32em; margin: 0 0 1em 0; }
.modal-content p { font-size: 1em; color: #ccc; margin: 0 0 1.3em 0;}
.custom-row {
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: center;
    gap: 0.7em;
    margin: 1.1em 0;
    width: 100%;
}
.custom-label {
    font-size: 1.05em;
    font-weight: bold;
    min-width: 2.8em;
    text-align: right;
    letter-spacing: 0.07em;
}
.select-group {
    display: flex;
    align-items: center;
    gap: 0.1em;
}
.select-group select {
    font-size: 1.16em;
    border-radius: 8px;
    border: 2px solid #FFD700;
    padding: 0.22em 0.75em;
    color: #FFD700;
    background: #101010;
    font-family: 'Roboto Mono', monospace;
    margin: 0 0.08em;
    min-width: 3.7em;
    appearance: none;
    outline: none;
    text-align: center;
}
.select-group select:focus { border-color: #FFB900; background: #222; color: #FFD700;}
.unit {
    font-size: 1em; color: #bbb; margin: 0 0.2em;
}
.modal-content .btn-row {
    display: flex; flex-direction: row; justify-content: center; align-items: center;
    gap: 2vw; width: 100%;     margin: 1.6em 0 0.7em 0;
}
.modal-content .btn-row button {
    font-size: 1.28em;
    font-weight: bold;
    border-radius: 12px;
    border: none;
    min-width: 36vw;
    background: #FFD700;
    color: #222;
    padding: 0.7em 0;
    margin: 0 8px;
    cursor: pointer;
    transition: background 0.15s;
}
.modal-content .btn-row button:active { background: #FFE066;}
@media (max-width: 500px) {
    .modal-content { padding: 14px 2vw;}
    .custom-label { min-width: 2.2em; font-size: 1em;}
    .custom-row { gap: 0.20em;}
    .modal-content .btn-row button { font-size: 1em; min-width: 42vw;}
}
@media (max-width: 350px) {
    .modal-content { padding: 4vw 0.5vw;}
    .custom-row { flex-direction: column; gap: 0.25em;}
}
</style>
</head>
<body>
<h1>é›¨è»’è¨ˆæ™‚å™¨</h1>

<div class="presets">
    <button class="preset-btn" onclick='setPreset(5,6,7,7.5); highlightPreset(this); showLabel("speech");'>5~7åˆ†<br>Â±30ç§’</button>
    <button class="preset-btn" onclick='setPreset(1,1.5,2,2.5); highlightPreset(this); showLabel("table");'>1~2åˆ†<br>+30ç§’</button>
    <button class="preset-btn" onclick='setPreset(2,2.5,3,3.5); highlightPreset(this); showLabel("eval");'>2~3åˆ†<br>Â±30ç§’</button>
    <button class="preset-btn" id="customBtn" onclick='openCustomModal(); highlightPreset(this); showLabel("none");'>è‡ªå®šç¾©<br>æ™‚é–“</button>
</div>
<div id="label-speech" style="font-size: 0.95em; display:none; margin-bottom:0.7em;">â–  åˆæ ¼ï¼š4åˆ†30ç§’~7åˆ†30ç§’</div>
<div id="label-table" style="font-size: 0.95em; display:none; margin-bottom:0.7em;">â–  åˆæ ¼ï¼š1åˆ†~2åˆ†30ç§’</div>
<div id="label-eval" style="font-size: 0.95em; display:none; margin-bottom:0.7em;">â–  åˆæ ¼ï¼š1åˆ†30ç§’~3åˆ†30ç§’</div>
<div class="timer-display" id="display">00:00</div>
<div class="controls-fab">
    <button id="resetBtn" onclick="resetTimer()" disabled>ğŸ” æ­¸é›¶</button>
    <button id="mainControlBtn" onclick="mainControl()" disabled>â–¶ï¸ é–‹å§‹</button>
</div>
<div class="bottom-bar">
    <button onclick="location.href='/'">ğŸ  å›é¦–é </button>
    <button id="fullscreenBtn" onclick="toggleFullscreen()"><span id="fsIcon">ğŸ”²</span> <span id="fsText">å…¨è¢å¹•</span></button>
</div>

<!-- æ»‘å‹•é¸å– Modal -->
<div class="modal" id="customModal">
  <div class="modal-content">
    <h3>è‡ªå®šç¾©æ™‚é–“è¨­å®š</h3>
    <p>è«‹è¨­å®šå„éšæ®µæ™‚é–“ï¼ˆé ˆåš´æ ¼éå¢ï¼‰ï¼š</p>
    <div class="custom-row">
      <span class="custom-label">ç¶ ç‡ˆï¼š</span>
      <div class="select-group">
        <select id="greenMin"></select>
        <span class="unit">åˆ†</span>
        <select id="greenSec"></select>
        <span class="unit">ç§’</span>
      </div>
    </div>
    <div class="custom-row">
      <span class="custom-label">é»ƒç‡ˆï¼š</span>
      <div class="select-group">
        <select id="yellowMin"></select>
        <span class="unit">åˆ†</span>
        <select id="yellowSec"></select>
        <span class="unit">ç§’</span>
      </div>
    </div>
    <div class="custom-row">
      <span class="custom-label">ç´…ç‡ˆï¼š</span>
      <div class="select-group">
        <select id="redMin"></select>
        <span class="unit">åˆ†</span>
        <select id="redSec"></select>
        <span class="unit">ç§’</span>
      </div>
    </div>
    <div class="custom-row">
      <span class="custom-label">é–ƒçˆï¼š</span>
      <div class="select-group">
        <select id="blinkMin"></select>
        <span class="unit">åˆ†</span>
        <select id="blinkSec"></select>
        <span class="unit">ç§’</span>
      </div>
    </div>
    <div class="btn-row">
      <button id="applyBtn" onclick="applyCustomTimes()">å¥—ç”¨</button>
      <button onclick="closeCustomModal()">å–æ¶ˆ</button>
    </div>
  </div>
</div>

<script>
// åˆå§‹åŒ– <select> å¡«å…¥ 0~59
["greenMin","greenSec","yellowMin","yellowSec","redMin","redSec","blinkMin","blinkSec"].forEach(id=>{
  const sel = document.getElementById(id);
  for(let i=0;i<=59;i++){
    let opt = document.createElement('option');
    opt.value = opt.text = i;
    sel.appendChild(opt);
  }
});
const spinnerState = {
  greenMin: 0, greenSec: 0, yellowMin: 0, yellowSec: 0,
  redMin: 0, redSec: 0, blinkMin: 0, blinkSec: 0
};

// è·Ÿéš¨é¸æ“‡å³æ™‚æ›´æ–°
["greenMin","greenSec","yellowMin","yellowSec","redMin","redSec","blinkMin","blinkSec"].forEach(id=>{
  document.getElementById(id).addEventListener('change', function(){
    spinnerState[id] = parseInt(this.value);
    checkCustomInputs();
  });
});

function highlightPreset(btn) {
    document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
}
function openCustomModal() {
    if (currentState !== 'init') return;
    document.getElementById("customModal").style.display = "flex";
    // é è¨­éƒ½å¡«å› 0
    Object.keys(spinnerState).forEach(id=>{
      document.getElementById(id).value = spinnerState[id];
    });
    checkCustomInputs();
}
function closeCustomModal() {
    document.getElementById("customModal").style.display = "none";
}
function getTimeValue(minKey, secKey) {
    return parseInt(document.getElementById(minKey).value)*60 + parseInt(document.getElementById(secKey).value);
}
function applyCustomTimes() {
    const g = getTimeValue('greenMin','greenSec');
    const y = getTimeValue('yellowMin','yellowSec');
    const r = getTimeValue('redMin','redSec');
    const b = getTimeValue('blinkMin','blinkSec');
    // åš´æ ¼éå¢æª¢æŸ¥
    if (!(g >= 0 && g < y && y < r && r < b)) {
        alert("è«‹ç¢ºèªå„éšæ®µæ™‚é–“ç‚ºåš´æ ¼éå¢ï¼ˆç¶ ç‡ˆ < é»ƒç‡ˆ < ç´…ç‡ˆ < é–ƒçˆï¼‰ï¼Œä¸”æ¯æ ¼éƒ½éœ€è¨­å®šï¼");
        return;
    }
    if (b === 0) {
        alert("è‡³å°‘å¿…é ˆè¨­å®šä¸€å€‹æ­£ç¢ºçš„æ™‚é–“ï¼");
        return;
    }
    thresholds = { green: g, yellow: y, red: r, blink: b };
    resetTimer();
    enableControls();
    let customBtn = document.getElementById("customBtn");
    highlightPreset(customBtn);
    showLabel("none");
    closeCustomModal();
}
function checkCustomInputs() {
    const keys = Object.keys(spinnerState);
    let hasValue = keys.some(k=>parseInt(document.getElementById(k).value)>0);
    document.getElementById("applyBtn").disabled = !hasValue;
}

// timer ä¸»è¦é‚è¼¯åŒä¸Š
let currentTime = 0, startTime = 0, timerInterval = null, blinkInterval = null, isBlinking = false;
let thresholds = { green: 0, yellow: 0, red: 0, blink: 0 };
let currentState = 'init';

function enableControls() {
    document.getElementById("mainControlBtn").disabled = false;
    document.getElementById("resetBtn").disabled = false;
}
function disableControls() {
    document.getElementById("mainControlBtn").disabled = true;
    document.getElementById("resetBtn").disabled = true;
}
function lockPresets() {
    document.querySelectorAll('.preset-btn').forEach(btn => btn.classList.add('disabled'));
}
function unlockPresets() {
    document.querySelectorAll('.preset-btn').forEach(btn => btn.classList.remove('disabled'));
}
function startTimer() {
    clearInterval(timerInterval);
    clearInterval(blinkInterval);
    startTime = Date.now() - currentTime * 1000;
    timerInterval = setInterval(updateTimer, 100);
    currentState = 'running';
    let mainBtn = document.getElementById("mainControlBtn");
    mainBtn.textContent = "â¸ï¸ æš«åœ";
    mainBtn.classList.add("active-start");
    mainBtn.classList.remove("active-pause");
    lockPresets();
    document.getElementById("resetBtn").disabled = false;
}
function pauseTimer() {
    clearInterval(timerInterval);
    currentState = 'paused';
    let mainBtn = document.getElementById("mainControlBtn");
    mainBtn.textContent = "â–¶ï¸ ç¹¼çºŒ";
    mainBtn.classList.add("active-pause");
    document.getElementById("resetBtn").disabled = false;
}
function resumeTimer() {
    startTime = Date.now() - currentTime * 1000;
    timerInterval = setInterval(updateTimer, 100);
    currentState = 'running';
    let mainBtn = document.getElementById("mainControlBtn");
    mainBtn.textContent = "â¸ï¸ æš«åœ";
    mainBtn.classList.add("active-start");
    mainBtn.classList.remove("active-pause");
    document.getElementById("resetBtn").disabled = false;
}
function resetTimer() {
    clearInterval(timerInterval);
    clearInterval(blinkInterval);
    currentTime = 0;
    updateDisplay();
    document.body.style.backgroundColor = "#111";
    isBlinking = false;
    currentState = 'init';
    unlockPresets();
    document.getElementById("resetBtn").disabled = true;
    document.getElementById("mainControlBtn").disabled = false;
    let mainBtn = document.getElementById("mainControlBtn");
    mainBtn.textContent = "â–¶ï¸ é–‹å§‹";
    mainBtn.classList.remove("active-start");
    mainBtn.classList.remove("active-pause");
}
function updateTimer() {
    currentTime = Math.floor((Date.now() - startTime) / 1000);
    updateDisplay();
    updateBackground();
}
function updateDisplay() {
    const m = Math.floor(currentTime / 60);
    const s = currentTime % 60;
    document.getElementById("display").textContent = String(m).padStart(2, '0') + ":" + String(s).padStart(2, '0');
}
function updateBackground() {
    if (currentTime >= thresholds.blink) {
        if (!isBlinking) {
            isBlinking = true;
            blinkInterval = setInterval(() => {
                document.body.style.backgroundColor = document.body.style.backgroundColor === "rgb(255, 0, 0)" ? "#111" : "rgb(255, 0, 0)";
            }, 500);
        }
    } else if (currentTime >= thresholds.red) {
        document.body.style.backgroundColor = "rgb(255,0,0)";
    } else if (currentTime >= thresholds.yellow) {
        document.body.style.backgroundColor = "rgb(255,255,0)";
    } else if (currentTime >= thresholds.green) {
        document.body.style.backgroundColor = "rgb(0,255,0)";
    } else {
        document.body.style.backgroundColor = "#111";
    }
}
function setPreset(g, y, r, b) {
    if (currentState !== 'init') return;
    thresholds.green = g * 60;
    thresholds.yellow = y * 60;
    thresholds.red = r * 60;
    thresholds.blink = b * 60;
    resetTimer();
    closeCustomModal();
    enableControls();
}
function showLabel(type) {
    document.getElementById("label-speech").style.display = type === "speech" ? "block" : "none";
    document.getElementById("label-table").style.display = type === "table" ? "block" : "none";
    document.getElementById("label-eval").style.display = type === "eval" ? "block" : "none";
}
function mainControl() {
    if (currentState === 'init') {
        startTimer();
    } else if (currentState === 'running') {
        pauseTimer();
    } else if (currentState === 'paused') {
        resumeTimer();
    }
}
// å…¨è¢å¹•åˆ‡æ›
function toggleFullscreen() {
    let fsBtn = document.getElementById("fullscreenBtn");
    let fsIcon = document.getElementById("fsIcon");
    let fsText = document.getElementById("fsText");
    if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
        fsIcon.textContent = "âŒ";
        fsText.textContent = "çµæŸå…¨è¢å¹•";
        fsBtn.title = "çµæŸå…¨è¢å¹•";
    } else {
        document.exitFullscreen();
        fsIcon.textContent = "ğŸ”²";
        fsText.textContent = "å…¨è¢å¹•";
        fsBtn.title = "å…¨è¢å¹•";
    }
}
document.addEventListener('fullscreenchange', function() {
    let fsIcon = document.getElementById("fsIcon");
    let fsBtn = document.getElementById("fullscreenBtn");
    let fsText = document.getElementById("fsText");
    if (document.fullscreenElement) {
        fsIcon.textContent = "âŒ";
        fsText.textContent = "çµæŸå…¨è¢å¹•";
        fsBtn.title = "çµæŸå…¨è¢å¹•";
    } else {
        fsIcon.textContent = "ğŸ”²";
        fsText.textContent = "å…¨è¢å¹•";
        fsBtn.title = "å…¨è¢å¹•";
    }
});
</script>
</body>
</html>