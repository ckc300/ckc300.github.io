<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
<title>é›¨è»’è¨ˆæ™‚å™¨</title>
<style>
html, body {
  margin: 0; padding: 0;
  width: 100%; height: 100%;
  overflow: hidden;
  background: #111;
  color: #fff;
  font-family: 'Noto Sans TC', sans-serif;
  transition: background-color 0.4s ease;
}

/* === é–‹å ´å‹•ç•« === */
#intro {
  position: fixed;
  inset: 0;
  background: #000;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  animation: introFade 2.4s ease forwards;
}
#intro img {
  width: 120px;
  height: auto;
  margin-bottom: 0.6em;
  filter: drop-shadow(0 0 10px #FFD700);
}
#intro h1 {
  font-size: 2.2em;
  color: #FFD700;
  letter-spacing: 0.1em;
  animation: textGlow 2s infinite alternate;
}
@keyframes introFade {
  0% { opacity: 0; }
  10% { opacity: 1; }
  85% { opacity: 1; }
  100% { opacity: 0; visibility: hidden; }
}
@keyframes textGlow {
  from { text-shadow: 0 0 4px #FFD700, 0 0 10px #FFD700; }
  to   { text-shadow: 0 0 15px #FFD700, 0 0 30px #FFDD55; }
}

/* æ¨™é¡Œå‘¼å¸å‹•ç•« */
@keyframes breathe {0%{filter:brightness(0.9);}50%{filter:brightness(1.3);}100%{filter:brightness(0.9);}}
@keyframes titleBreatheBW {
  0%{color:rgb(128,128,128);}25%{color:rgb(191,191,191);}50%{color:rgb(255,255,255);}
  75%{color:rgb(191,191,191);}100%{color:rgb(128,128,128);}
}

/* æ¡†æ¶å®¹å™¨ */
#appContainer {
  position: relative;
  width: 100vw; height: 100vh;
  display: flex; justify-content: center; align-items: center;
  overflow: hidden; background: inherit;
}
#appContent {
  position: absolute; top: 50%; left: 50%;
  transform: translate(-50%, -50%) scale(1);
  width: 360px; height: 640px; transform-origin: center;
}

/* æ©«å¼æç¤º */
#rotateTip {
  display: none; position: fixed; inset: 0;
  background: #000; color: #FFD700;
  font-size: 1.8em; font-weight: bold;
  justify-content: center; align-items: center;
  z-index: 999;
}

/* æ¨™é¡Œåˆ— */
.header {
  display: flex; justify-content: center; align-items: center; gap: 1.2em;
  margin: 0.8em auto 0.5em; width: fit-content; text-align: center;
}
.header img {
  height: clamp(60px, 10vw, 100px);
  width: auto; animation: breathe 3s ease-in-out infinite;
}
.header h1 {
  font-size: clamp(2rem, 6vw, 2.6rem); /* âœ… èª¿æ•´å­—ç´šç¯„åœ */
  font-weight: normal;                 /* âœ… ç§»é™¤åŠ ç²— */
  letter-spacing: 0.05em;              /* âœ… å¾®ç¸®å­—è· */
  margin: 0;
  white-space: nowrap;                 /* âœ… å¼·åˆ¶å–®è¡Œé¡¯ç¤º */
  transition: color 0.4s ease;
  animation: titleBreatheBW 3.5s ease-in-out infinite;
}

/* åˆ†éš”ç·š */
.divider {width:90%;max-width:500px;height:1px;margin:0.6em auto 1.2em;background:rgba(102,102,102,0.4);}

/* é è¨­æŒ‰éˆ•åˆ— */
.presets {
  display:flex;justify-content:space-between;align-items:center;gap:0.8em;
  width:90%;max-width:420px;margin:1.2em auto;
}
.preset-btn {
  flex:1 1 0;aspect-ratio:1/1;border-radius:50%;
  background:#444;border:none;color:#ccc;font-weight:bold;
  font-size:clamp(0.9em,2vw,1em);
  cursor:pointer;transition:transform .15s,background .2s;
}
.preset-btn.selected {background:#222;color:#FFD700;transform:scale(1.08);border:2px solid #FFD700;}
/* è¨ˆæ™‚é¡¯ç¤º */
.timer-display {
  font-family:'Roboto Mono',monospace;font-weight:bold;
  background:#000;color:#fff;border-radius:20px;text-align:center;
  width:90%;max-width:90vw;height:35vh;display:flex;align-items:center;justify-content:center;
  margin:1em 0 2em;box-shadow:0 2px 10px #0006;
}
.timer-display span {font-size:clamp(6rem,25vw,14rem);}
#symbol {
  position:absolute;top:8px;right:14px;font-size:2rem;user-select:none;
  text-shadow:2px 2px 4px rgba(0,0,0,0.6);
}

/* === æ‰‹æ©Ÿé¡¯ç¤º === */
@media (max-width:480px){
  .timer-display{width:95%;height:20vh;margin:0.6em auto 1.4em;}
  .timer-display span{font-size:clamp(5rem,27vw,13rem);}
  .bottom-bar button{font-size:0.9em;padding:0.25em 0.8em;min-height:38px;}
  .bottom-bar{bottom:40px;padding:0 0.8em;}
}

/* === å¹³æ¿å„ªåŒ– === */
@media (min-width:768px) and (max-width:1024px){
  .timer-display{height:25vh;}
  .controls{gap:2em;}
  .preset-btn{font-size:1.1em;}
}

/* === æŒ‰éˆ•é–ƒçˆæ•ˆæœ === */
button.flash {animation:flashBorder 0.3s ease;}
@keyframes flashBorder {
  0% {box-shadow:0 0 8px 3px #FFD700;}
  100% {box-shadow:none;}
}

/* æ§åˆ¶æŒ‰éˆ• */
.controls {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 40px;
  margin-bottom: 3em;
}
.controls button {
  min-height: unset;
  padding: 0.4em 1.6em;
  border-radius: 10px;
  font-size: 1.2em;
  font-weight: bold;
  border: none;
  cursor: pointer;
  white-space: nowrap;
  transition: filter .15s, background .2s, color .2s;
}
#mainControl {
  background: #444; color: #ccc;
}
#reset {
  background: #444; color: #777;
}
#mainControl.active, #reset.active {
  background: #FFD700;
  color: #000;
  border: 2px solid #000;
  box-shadow: 0 0 6px rgba(0,0,0,0.5);
}

/* åº•éƒ¨æ¬„ */
.bottom-bar {
  position: fixed; bottom: 10px; left: 0; right: 0;
  display: flex; justify-content: space-between;
  padding: 0 1em;
  transition: opacity 0.3s ease;
}
.bottom-bar.hidden { opacity: 0; pointer-events: none; }

.bottom-bar button {
  background: #222; color: #fff;
  border: 2px solid #fff;
  border-radius: 10px;
  font-weight: bold;
  font-size: 1em;
  min-height: 48px;
  padding: 0.4em 1.3em;
  cursor: pointer;
}

/* Modal */
.modal {
  display: none;
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.7);
  justify-content: center; align-items: center;
  z-index: 100;
}
.modal-content {
  background: #181818;
  color: #fff;
  padding: 20px 6vw;
  border-radius: 16px;
  text-align: center;
  animation: fadeIn 0.3s ease;
}
@keyframes fadeIn { from{opacity:0;} to{opacity:1;} }

.custom-row { margin: 0.8em 0; }
select {
  font-size: 1.1em;
  border-radius: 6px;
  border: 2px solid #FFD700;
  background: #000;
  color: #FFD700;
  padding: 0.2em 0.6em;
}
.modal-btns {
  display: flex; justify-content: center; gap: 1.2em;
  margin-top: 1em;
}
.modal-btns button {
  border-radius: 10px;
  font-size: 1.1em; font-weight: bold;
  padding: 0.5em 1.2em;
  cursor: pointer;
  border: none;
}
#applyBtn {
  background: #444; color: #999;
}
#applyBtn.active {
  background: #FFD700; color: #000;
}
#cancelBtn {
  background: #FFD700; color: #000;
}
</style>
</head>

<body>
<div id="intro">
  <img src="Pathways_Power_Hub.webp" alt="é ­åƒ">
  <h1>é›¨è»’è¨ˆæ™‚å™¨</h1>
</div>

<div id="rotateTip">è«‹æ—‹è½‰æ‰‹æ©Ÿä»¥ç›´å¼è¢å¹•æ“ä½œ ğŸ“±</div>

<div id="appContainer">
  <div id="appContent">
    <div id="symbol"></div>
    <div class="header" id="header">
      <img id="avatar" src="Pathways_Power_Hub.webp" alt="é ­åƒ">
      <h1 id="title">é›¨è»’è¨ˆæ™‚å™¨</h1>
    </div>
    <div class="divider"></div>

    <div class="presets">
      <button class="preset-btn" onclick="setPreset(5,6,7,7.5,this)">5â€“7åˆ†<br>Â±30ç§’</button>
      <button class="preset-btn" onclick="setPreset(1,1.5,2,2.5,this)">1â€“2åˆ†<br>+30ç§’</button>
      <button class="preset-btn" onclick="setPreset(2,2.5,3,3.5,this)">2â€“3åˆ†<br>Â±30ç§’</button>
      <button class="preset-btn" onclick="openCustomModal(this)">è‡ªå®šç¾©</button>
    </div>

    <div class="timer-display" id="display"><span>00:00</span></div>

    <div class="controls">
      <button id="mainControl" onclick="buttonFlash(this); mainControl();" disabled>â–¶ï¸ é–‹å§‹</button>
      <button id="reset" onclick="buttonFlash(this); resetTimer();" disabled>ğŸ” æ­¸é›¶</button>
    </div>

    <div class="bottom-bar" id="bottomBar">
      <button id="homeBtn" onclick="location.href='https://ckc300.github.io/'">ğŸ  å›é¦–é </button>
      <button id="fsBtn" onclick="buttonFlash(this); toggleFullscreen()">ğŸ”² å…¨è¢å¹•</button>
    </div>

    <div class="modal" id="customModal">
      <div class="modal-content">
        <h3>è‡ªå®šç¾©æ™‚é–“è¨­å®š</h3>
        <div class="custom-row">ç¶ ç‡ˆï¼š<select id="gMin"></select>åˆ†<select id="gSec"></select>ç§’</div>
        <div class="custom-row">é»ƒç‡ˆï¼š<select id="yMin"></select>åˆ†<select id="ySec"></select>ç§’</div>
        <div class="custom-row">ç´…ç‡ˆï¼š<select id="rMin"></select>åˆ†<select id="rSec"></select>ç§’</div>
        <div class="custom-row">é–ƒç´…ï¼š<select id="bMin"></select>åˆ†<select id="bSec"></select>ç§’</div>
        <div class="modal-btns">
          <button id="applyBtn" onclick="buttonFlash(this); applyCustom();" disabled>å¥—ç”¨</button>
          <button id="cancelBtn" onclick="buttonFlash(this); closeModal()">å–æ¶ˆ</button>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- ç¬¬3æ®µé–‹å§‹ -->
<script>
/* === é˜²é–å±åŠŸèƒ½ï¼ˆå« Safari ä¿éšªæ–¹æ¡ˆï¼‰ === */
let wakeLock = null;
let videoLock = null;

async function requestWakeLock() {
  try {
    if ('wakeLock' in navigator) {
      wakeLock = await navigator.wakeLock.request('screen');
      wakeLock.addEventListener('release', () => console.log('ğŸ”“ é˜²é–å±å·²é‡‹æ”¾'));
      console.log('âœ… å·²å•Ÿç”¨é˜²é–å±');
    } else {
      console.warn('âš ï¸ ä¸æ”¯æ´ Wake Lock APIï¼Œå•Ÿç”¨ä¿éšªæ–¹æ¡ˆ');
      enableVideoLock();
    }
  } catch (err) {
    console.error('âš ï¸ é˜²é–å±éŒ¯èª¤:', err);
    enableVideoLock();
  }
}

// iOS Safari ä¿éšªæ–¹æ¡ˆ â€” éš±è—éœéŸ³å½±ç‰‡ä¿æŒäº®å±
function enableVideoLock() {
  if (videoLock) return;
  const v = document.createElement('video');
  v.src = 'data:video/mp4;base64,AAAAHGZ0eXBtcDQyAAAAAG1wNDFtcDQyaXNvbQAAABxnZHJtaW5mAAAAE21kaW5mAAAAA2libWlhbmltAAAAAW1vb3YAAAABbWRhdGEAAAAA';
  v.loop = true; v.muted = true; v.playsInline = true; v.style.display = 'none';
  document.body.appendChild(v);
  v.play().then(()=>console.log('ğŸ¥ å•Ÿç”¨éš±è—å½±ç‰‡é˜²é–å±')).catch(()=>{});
  videoLock = v;
}

async function releaseWakeLock() {
  if (wakeLock) {
    try { await wakeLock.release(); wakeLock = null; console.log('ğŸ”“ å·²é‡‹æ”¾é˜²é–å±'); } catch (err) {}
  }
  if (videoLock) { videoLock.pause(); videoLock.remove(); videoLock = null; console.log('ğŸ›‘ é—œé–‰éš±è—å½±ç‰‡é˜²é–å±'); }
}

document.addEventListener('visibilitychange', () => {
  if (document.visibilityState === 'visible') requestWakeLock();
  else releaseWakeLock();
});
window.addEventListener('beforeunload', releaseWakeLock);
window.addEventListener('load', requestWakeLock);

/* === ç‹€æ…‹ç‰©ä»¶ === */
const TimerState = {
  status: 'init',
  thresholds: {green:0,yellow:0,red:0,blink:0},
  time: 0,
  startAt: 0,
  timer: null,
  blink: null,
  blinkState: false,
  selectedPreset: null
};

/* === åˆå§‹åŒ–è‡ªå®šç¾©é¸å–® === */
function initSelects(){
  const config={g:[3,40],y:[4,40],r:[5,40],b:[6,40]};
  const secs=[0,30];
  for(let p of ['g','y','r','b']){
    const minSel=document.getElementById(p+'Min');
    const secSel=document.getElementById(p+'Sec');

    let pm=document.createElement('option'); pm.value=""; pm.text="--"; pm.selected=true; pm.disabled=true; minSel.appendChild(pm);
    let ps=document.createElement('option'); ps.value=""; ps.text="--"; ps.selected=true; ps.disabled=true; secSel.appendChild(ps);

    for(let i=config[p][0];i<=config[p][1];i++){
      let o=document.createElement('option'); o.value=i;o.text=i;minSel.appendChild(o);
    }
    for(let s of secs){
      let o=document.createElement('option'); o.value=s;o.text=s.toString().padStart(2,'0');secSel.appendChild(o);
    }

    minSel.addEventListener('change',checkCustomInputs);
    secSel.addEventListener('change',checkCustomInputs);
  }
}
initSelects();

/* === æŒ‰éˆ•é–ƒå…‰å›é¥‹ === */
function buttonFlash(btn){
  btn.classList.add('flash');
  setTimeout(()=>btn.classList.remove('flash'),300);
}

/* === UIæ§åˆ¶ === */
function toggleBottomBar(show){
  const bar=document.getElementById('bottomBar');
  if(show) bar.classList.remove('hidden'); else bar.classList.add('hidden');
}
function openCustomModal(btn){
  if(TimerState.status!=='init')return;
  TimerState.selectedPreset=btn;
  document.getElementById('customModal').style.display='flex';
  checkCustomInputs();
}
function closeModal(){document.getElementById('customModal').style.display='none';}

function getVal(id){
  const m=document.getElementById(id).value;
  const s=document.getElementById(id.replace('Min','Sec')).value;
  if(m===""||s==="")return NaN;
  return parseInt(m)*60+parseInt(s);
}
function checkCustomInputs(){
  const g=getVal('gMin'),y=getVal('yMin'),r=getVal('rMin'),b=getVal('bMin');
  const btn=document.getElementById('applyBtn');
  if([g,y,r,b].some(isNaN)||!(g<y && y<r && r<b)){
    btn.disabled=true;btn.classList.remove('active');return;
  }
  btn.disabled=false;btn.classList.add('active');
}
function applyCustom(){
  const g=getVal('gMin'),y=getVal('yMin'),r=getVal('rMin'),b=getVal('bMin');
  if([g,y,r,b].some(isNaN))return;
  if(!(g<y && y<r && r<b))return;
  TimerState.thresholds={green:g,yellow:y,red:r,blink:b};
  closeModal();enableControls();highlight(TimerState.selectedPreset);
}
function setPreset(g,y,r,b,btn){
  if(TimerState.status!=='init')return;
  TimerState.thresholds={green:g*60,yellow:y*60,red:r*60,blink:b*60};
  enableControls();highlight(btn);
}
function highlight(btn){
  document.querySelectorAll('.preset-btn').forEach(b=>b.classList.remove('selected'));
  btn.classList.add('selected');
  TimerState.selectedPreset=btn;
  document.getElementById('mainControl').classList.add('active');
}

/* === æ§åˆ¶ === */
function mainControl(){
  if(TimerState.status==='init') startTimer();
  else if(TimerState.status==='running') pauseTimer();
  else if(TimerState.status==='paused') resumeTimer();
}
function startTimer(){
  TimerState.status='running';
  TimerState.startAt=Date.now()-TimerState.time*1000;
  TimerState.timer=setInterval(update,100);
  document.getElementById('mainControl').textContent='â¸ï¸ æš«åœ';
  document.getElementById('reset').disabled=true;
  document.querySelectorAll('.preset-btn').forEach(b=>b.disabled=true);
  toggleBottomBar(false);
}
function pauseTimer(){
  clearInterval(TimerState.timer);
  TimerState.status='paused';
  document.getElementById('mainControl').textContent='â–¶ï¸ ç¹¼çºŒ';
  document.getElementById('reset').disabled=false;
  document.getElementById('reset').classList.add('active');
  toggleBottomBar(true);
  if(TimerState.blink){clearInterval(TimerState.blink);TimerState.blink=null;}
}
function resumeTimer(){
  TimerState.startAt=Date.now()-TimerState.time*1000;
  TimerState.timer=setInterval(update,100);
  TimerState.status='running';
  document.getElementById('mainControl').textContent='â¸ï¸ æš«åœ';
  document.getElementById('reset').disabled=true;
  document.getElementById('reset').classList.remove('active');
  toggleBottomBar(false);
}
function resetTimer(){
  clearInterval(TimerState.timer);
  if(TimerState.blink){clearInterval(TimerState.blink);TimerState.blink=null;}
  document.body.style.background='#111';
  document.getElementById('symbol').textContent='';
  document.getElementById('avatar').style.filter='invert(0)';
  document.getElementById('title').style.color='#fff';
  TimerState.status='init';TimerState.time=0;
  updateDisplay();
  document.getElementById('mainControl').textContent='â–¶ï¸ é–‹å§‹';
  document.getElementById('mainControl').classList.remove('active');
  document.getElementById('mainControl').disabled=true;
  document.getElementById('reset').disabled=true;
  document.getElementById('reset').classList.remove('active');
  document.querySelectorAll('.preset-btn').forEach(b=>{b.disabled=false;b.classList.remove('selected');});
  toggleBottomBar(true);
  TimerState.blinkState=false;
}
function enableControls(){
  document.getElementById('mainControl').disabled=false;
  toggleBottomBar(true);
}

/* === æ›´æ–° === */
function update(){
  TimerState.time=Math.floor((Date.now()-TimerState.startAt)/1000);
  updateDisplay();updateBg();
}
function updateDisplay(){
  const m=Math.floor(TimerState.time/60),s=TimerState.time%60;
  document.querySelector('#display span').textContent=`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}

/* === èƒŒæ™¯èˆ‡ç¬¦è™Ÿ === */
function updateBg(){
  const sym=document.getElementById('symbol');
  const avatar=document.getElementById('avatar');
  const title=document.getElementById('title');
  const t=TimerState.time, th=TimerState.thresholds;
  if(t>=th.blink){
    if(!TimerState.blink && TimerState.status==='running'){
      TimerState.blink=setInterval(()=>{
        TimerState.blinkState=!TimerState.blinkState;
        document.body.style.background=TimerState.blinkState?'#FF2400':'#000000';
        avatar.style.filter=TimerState.blinkState?'invert(0)':'invert(1)';
      },300);
    }
    sym.textContent='âŒ';title.style.color='#fff';
  } else {
    if(TimerState.blink){clearInterval(TimerState.blink);TimerState.blink=null;document.body.style.background='#FF2400';}
    if(t>=th.red){document.body.style.background='#FF2400';sym.textContent='â›”';title.style.color='#fff';avatar.style.filter='invert(1)';}
    else if(t>=th.yellow){document.body.style.background='#FFD55A';sym.textContent='âš ï¸';title.style.color='#000';avatar.style.filter='invert(1)';}
    else if(t>=th.green){document.body.style.background='#4B5320';sym.textContent='â˜‘ï¸';title.style.color='#fff';avatar.style.filter='invert(1)';}
    else{document.body.style.background='#111';sym.textContent='';title.style.color='#fff';avatar.style.filter='invert(0)';}
  }
}

/* === å…¶ä»– === */
function toggleFullscreen(){
  const b=document.getElementById('fsBtn');
  if(!document.fullscreenElement){document.documentElement.requestFullscreen();b.textContent='âŒ çµæŸå…¨è¢å¹•';}
  else{document.exitFullscreen();b.textContent='ğŸ”² å…¨è¢å¹•';}
}
function handleOrientation(){
  const isMobile=/Mobi|Android|iPhone|iPad/i.test(navigator.userAgent);
  const isLandscape=window.matchMedia("(orientation: landscape)").matches;
  const tip=document.getElementById('rotateTip');
  const content=document.getElementById('appContent');
  if(isMobile && isLandscape){tip.style.display='flex';content.style.display='none';}
  else{tip.style.display='none';content.style.display='block';scaleApp();}
}
function scaleApp(){
  const app=document.getElementById('appContent');
  const baseWidth=360, baseHeight=640;
  const scale=Math.min(window.innerWidth/baseWidth, window.innerHeight/baseHeight);
  app.style.transform=`translate(-50%, -50%) scale(${scale})`;
}
window.addEventListener('resize',handleOrientation);
window.addEventListener('orientationchange',handleOrientation);
window.addEventListener('load',handleOrientation);
</script>
</body>
</html>
